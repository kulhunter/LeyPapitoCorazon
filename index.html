<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ley Papito Coraz칩n | Gu칤a Legal y Emocional Chile</title>
    
    <!-- SEO METADATA - OPTIMIZADO PARA RESPUESTAS DE GOOGLE -->
    <meta name="description" content="Gu칤a completa Ley 21.484. Aprende tus derechos y deberes sobre pensi칩n de alimentos, visitas, y deudas. Explicado f치cil para mam치s y pap치s en Chile.">
    <meta name="keywords" content="ley papito corazon, pensi칩n alimentos chile, registro nacional de deudores, retenci칩n afp, demanda alimentos, cuidado personal, visitas, mediaci칩n familiar">
    <meta name="author" content="solucionador.cl">
    <meta property="og:title" content="Ley Papito Coraz칩n: Gu칤a Definitiva">
    <meta property="og:description" content="Baja la ansiedad. Entiende la ley. Recupera tu paz mental. Gu칤a legal chilena explicada en f치cil.">
    
    <!-- Google Fonts (Alta Legibilidad para Textos Largos) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Lato:wght@300;400;700&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7868880098336635" crossorigin="anonymous"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        body: ['Lato', 'sans-serif'],
                        serif: ['Merriweather', 'serif'], // Para lectura profunda
                    },
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                            950: '#020617',
                        },
                        brand: {
                            purple: '#8b5cf6',
                            pink: '#ec4899',
                            blue: '#3b82f6',
                            gold: '#f59e0b',
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body { margin: 0; background-color: #0f172a; color: #f1f5f9; overflow-x: hidden; font-family: 'Lato', sans-serif; }
        
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 30%, #1e293b 0%, #0f172a 100%);
        }

        /* Tipograf칤a Jer치rquica */
        h1, h2, h3 { font-family: 'Montserrat', sans-serif; }
        p, li { font-family: 'Lato', sans-serif; font-size: 1.05rem; line-height: 1.8; color: #cbd5e1; }
        .text-reading { font-family: 'Merriweather', serif; } /* Para bloques largos de lectura */

        /* Estilo Input Chatbot */
        .ai-input-wrapper {
            position: relative;
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .ai-input-wrapper:focus-within {
            border-color: #ec4899;
            box-shadow: 0 0 25px rgba(236, 72, 153, 0.2);
            background: rgba(30, 41, 59, 0.9);
        }

        /* Resultados */
        .ai-result-card {
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #8b5cf6;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            animation: slideUp 0.3s ease-out;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        .ai-content h1, .ai-content h2 { color: #fff; font-weight: 700; margin-top: 1rem; }
        .ai-content strong { color: #f472b6; font-weight: 700; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Utilidades */
        .hidden { display: none !important; }
        .visible-section { display: block !important; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.99); } to { opacity: 1; transform: scale(1); } }
        
        .legal-block { 
            background: rgba(51, 65, 85, 0.3); 
            padding: 1.5rem; 
            margin: 1.5rem 0; 
            border-radius: 12px; 
            border-left: 4px solid #94a3b8;
        }

        /* FAQ Accordions */
        .faq-item { margin-bottom: 1rem; }
        .faq-trigger {
            width: 100%; text-align: left; padding: 1.25rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            display: flex; justify-content: space-between; items-center;
            transition: all 0.2s;
        }
        .faq-trigger:hover { background: rgba(30, 41, 59, 0.8); border-color: rgba(255,255,255,0.1); }
        .faq-content { display: none; padding: 1.5rem; border-left: 2px solid #475569; margin-left: 1rem; margin-top: 0.5rem; color: #cbd5e1; }
        
        .gradient-title {
            background: linear-gradient(135deg, #ffffff 0%, #d8b4fe 50%, #f472b6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Sticky Mobile TOC */
        .mobile-toc-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 100;
            background: #8b5cf6; color: white; border-radius: 50%; width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        /* Footer Attribution */
        .attribution-footer {
            margin-top: 4rem; padding-bottom: 2rem; text-align: center;
            font-size: 0.85rem; color: #64748b;
        }
        .attribution-footer a { color: #94a3b8; text-decoration: none; font-weight: bold; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        
        /* Loading */
        .typing-indicator span {
            display: inline-block; width: 8px; height: 8px;
            background-color: #a855f7; border-radius: 50%;
            animation: typing 1s infinite; margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); opacity: 0.5; } 50% { transform: translateY(-5px); opacity: 1; } }
    </style>
</head>
<body class="antialiased selection:bg-purple-500 selection:text-white">

    <div id="canvas-container"></div>

    <!-- LANDING PRINCIPAL -->
    <div id="landing-section" class="min-h-screen flex flex-col items-center justify-center p-4 relative z-10">
        
        <!-- Status Badge -->
        <div class="mb-8 animate-float">
            <span class="bg-slate-800/80 backdrop-blur-sm border border-slate-600 px-5 py-2 rounded-full text-xs md:text-sm font-bold tracking-wide text-white shadow-lg flex items-center gap-2">
                <i class="fa-solid fa-check-circle text-green-400"></i>
                Actualizado Ley 21.484 Chile 游뻟릖
            </span>
        </div>

        <h1 class="text-5xl md:text-8xl font-black text-center leading-tight mb-4 tracking-tight">
            LEY PAPITO<br>
            <span class="gradient-title">CORAZ칍N</span>
        </h1>
        
        <p class="text-slate-300 mb-10 text-center max-w-2xl text-lg md:text-xl font-light leading-relaxed">
            La ansiedad viene de no saber. Aqu칤 te explicamos <strong>tus derechos y deberes</strong> sin palabras dif칤ciles, para que recuperes el control.
        </p>

        <!-- INPUT IA -->
        <div class="w-full max-w-2xl relative z-50 mb-12">
            <div class="ai-input-wrapper flex items-center p-2">
                <div class="pl-4 pr-3 text-brand-purple text-2xl">
                    <i class="fa-solid fa-scale-balanced"></i>
                </div>
                <input type="text" id="ai-search-input" 
                    placeholder="Escribe lo que te preocupa: 'no paga pensi칩n', 'no me deja ver al ni침o'..." 
                    class="w-full bg-transparent border-none outline-none text-white placeholder-slate-400 text-lg py-3 font-medium truncate"
                    onkeypress="handleKeyPress(event)" autocomplete="off">
                <button onclick="performSearch()" class="bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white p-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-violet-500/30 transform hover:scale-105 active:scale-95 font-bold">
                    Preguntar
                </button>
            </div>
            <div id="ai-results-panel" class="hidden absolute top-full left-0 w-full mt-4 z-50"></div>
        </div>

        <!-- SELECCI칍N DE PERFIL (UX CLAVE) -->
        <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-6 px-2">
            
            <!-- TARJETA MAM츼 -->
            <button onclick="enterSite('mama')" class="group relative overflow-hidden bg-slate-800/40 hover:bg-slate-800/60 border border-slate-700/50 hover:border-pink-500/50 p-8 rounded-3xl text-left transition-all duration-300">
                <div class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fa-solid fa-venus text-9xl text-pink-500"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 group-hover:text-pink-400 transition-colors">SOY MAM츼</h3>
                <p class="text-pink-300 font-bold text-sm uppercase tracking-wider mb-4">"Estoy cansada de cobrar"</p>
                <ul class="text-slate-400 text-sm space-y-2">
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-pink-500 mt-1"></i> C칩mo funciona la retenci칩n autom치tica.</li>
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-pink-500 mt-1"></i> 칄l trabaja "en negro" o esconde plata.</li>
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-pink-500 mt-1"></i> Miedo a represalias o amenazas.</li>
                </ul>
                <div class="mt-6 flex items-center gap-2 text-pink-400 text-sm font-bold group-hover:underline decoration-pink-500 underline-offset-4">
                    Entrar a la gu칤a <i class="fa-solid fa-arrow-right"></i>
                </div>
            </button>
            
            <!-- TARJETA PAP츼 -->
            <button onclick="enterSite('papa')" class="group relative overflow-hidden bg-slate-800/40 hover:bg-slate-800/60 border border-slate-700/50 hover:border-blue-500/50 p-8 rounded-3xl text-left transition-all duration-300">
                <div class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fa-solid fa-mars text-9xl text-blue-500"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 group-hover:text-blue-400 transition-colors">SOY PAP츼</h3>
                <p class="text-blue-300 font-bold text-sm uppercase tracking-wider mb-4">"Quiero ver a mi hijo / Regularizar"</p>
                <ul class="text-slate-400 text-sm space-y-2">
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-blue-500 mt-1"></i> Me demandaron y no tengo trabajo.</li>
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-blue-500 mt-1"></i> Pago, pero no me deja ver a los ni침os.</li>
                    <li class="flex items-start gap-2"><i class="fa-solid fa-check text-blue-500 mt-1"></i> Dudas sobre en qu칠 se gasta la plata.</li>
                </ul>
                <div class="mt-6 flex items-center gap-2 text-blue-400 text-sm font-bold group-hover:underline decoration-blue-500 underline-offset-4">
                    Entrar a la gu칤a <i class="fa-solid fa-arrow-right"></i>
                </div>
            </button>
        </div>

        <div class="attribution-footer absolute bottom-0 w-full">
            <a href="https://solucionador.cl" target="_blank" class="hover:text-brand-purple transition-colors">Tecnolog칤a desarrollada por <strong>solucionador.cl</strong></a>
        </div>
    </div>

    <!-- INTERFAZ DE GU칈A (CONTENIDO) -->
    <div id="guide-ui" class="hidden min-h-screen bg-[#0f172a] relative z-20">
        
        <!-- Header Sticky -->
        <header class="fixed top-0 w-full bg-[#0f172a]/95 backdrop-blur-md border-b border-slate-800 z-40 px-4 md:px-8 py-4 flex justify-between items-center shadow-lg">
            <button onclick="exitSite()" class="text-slate-400 hover:text-white font-bold text-sm uppercase flex items-center gap-2 transition-colors">
                <div class="bg-slate-800 p-2 rounded-full"><i class="fa-solid fa-arrow-left"></i></div>
                <span class="hidden md:inline">Volver</span>
            </button>
            <div id="profile-badge"></div>
        </header>

        <div class="max-w-7xl mx-auto pt-24 px-4 pb-32 grid grid-cols-1 lg:grid-cols-12 gap-8 md:gap-12">
            
            <!-- 칈ndice Lateral (Desktop) -->
            <aside class="lg:col-span-3 hidden lg:block">
                <div class="sticky top-28">
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Contenido de la Gu칤a</h4>
                    <nav id="toc-desktop" class="space-y-1 max-h-[75vh] overflow-y-auto custom-scrollbar pr-2 border-l border-slate-800 pl-4">
                        <!-- JS Injected -->
                    </nav>
                </div>
            </aside>

            <!-- Contenido Principal -->
            <main id="main-content" class="lg:col-span-9 space-y-12 md:pr-10">
                <!-- JS Injected -->
            </main>
        </div>

        <!-- Bot칩n Flotante 칈ndice (Mobile) -->
        <button id="mobile-toc-toggle" class="lg:hidden mobile-toc-btn shadow-lg" onclick="document.getElementById('mobile-toc-modal').classList.remove('hidden')">
            <i class="fa-solid fa-list-ul"></i>
        </button>

        <!-- Modal 칈ndice (Mobile) -->
        <div id="mobile-toc-modal" class="hidden fixed inset-0 z-[150] bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
            <div class="bg-slate-900 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-white font-bold text-lg">칈ndice de Temas</h3>
                    <button onclick="document.getElementById('mobile-toc-modal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <nav id="toc-mobile" class="space-y-3 overflow-y-auto max-h-[60vh]">
                    <!-- JS Injected -->
                </nav>
            </div>
        </div>

        <div class="attribution-footer">
            <a href="https://solucionador.cl" target="_blank">Desarrollado con 仇벒잺 y 丘뒲잺 por <strong>solucionador.cl</strong></a>
        </div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        const apiKey = ""; // API KEY

        // --- CONTENIDO EXPANDIDO Y ESTRUCTURADO ---
        const contentData = {
            mama: {
                color: 'pink',
                icon: 'venus',
                title: 'Gu칤a para Madres',
                toc: [
                    {id:'empatia', t:'Primero: Respira'},
                    {id:'ley21484', t:'La Nueva Ley (Autom치tica)'},
                    {id:'cobro-paso', t:'Paso a Paso: C칩mo Cobrar'},
                    {id:'afp', t:'La Carta de la AFP'},
                    {id:'informales', t:'쯏 si trabaja en negro?'},
                    {id:'abuelos', t:'Demandar a los Abuelos'},
                    {id:'miedos', t:'Miedos Frecuentes'},
                    {id:'diccionario', t:'Diccionario Simple'}
                ],
                html: `
                    <!-- BLOQUE EMPAT칈A -->
                    <section id="empatia" class="scroll-mt-32 animate-fadeIn">
                        <div class="bg-pink-900/10 border-l-4 border-pink-500 p-6 md:p-8 rounded-r-xl">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">Sabemos que est치s cansada.</h2>
                            <p class="text-slate-300 text-lg">Probablemente llevas a침os pidiendo, persiguiendo y recibiendo excusas. Es normal sentir rabia y frustraci칩n. <br><br>
                            Pero te tenemos una buena noticia: <strong>La carga ya no es tuya.</strong> Con la Ley 21.484, el Estado asume la responsabilidad de buscar el dinero. Tu trabajo ahora es solo activar el mecanismo. Aqu칤 aprender치s c칩mo.</p>
                        </div>
                    </section>

                    <!-- LEY 21.484 -->
                    <section id="ley21484" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6"> <span class="text-pink-500">#1</span> Se acab칩 la investigaci칩n propia</h2>
                        <p class="mb-6 text-xl text-white font-medium">Olv칤date de jugar al detective.</p>
                        <p class="mb-4">Antes, t칰 ten칤as que averiguar d칩nde trabajaba 칠l. Ahora, el Tribunal de Familia tiene conexi칩n directa (interconexi칩n) con:</p>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                            <div class="bg-slate-800 p-4 rounded-lg text-center border border-slate-700"><i class="fa-solid fa-building-columns text-pink-400 text-2xl mb-2"></i><div class="text-sm font-bold">Bancos</div></div>
                            <div class="bg-slate-800 p-4 rounded-lg text-center border border-slate-700"><i class="fa-solid fa-file-invoice-dollar text-pink-400 text-2xl mb-2"></i><div class="text-sm font-bold">SII</div></div>
                            <div class="bg-slate-800 p-4 rounded-lg text-center border border-slate-700"><i class="fa-solid fa-piggy-bank text-pink-400 text-2xl mb-2"></i><div class="text-sm font-bold">AFP</div></div>
                            <div class="bg-slate-800 p-4 rounded-lg text-center border border-slate-700"><i class="fa-solid fa-car text-pink-400 text-2xl mb-2"></i><div class="text-sm font-bold">Registro Civil</div></div>
                        </div>
                        <p>Si 칠l tiene plata en <strong>cualquier cuenta bancaria formal</strong> o instrumento financiero, el tribunal lo sabr치.</p>
                    </section>

                    <!-- PASO A PASO -->
                    <section id="cobro-paso" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6"><span class="text-pink-500">#2</span> Paso a Paso: Activar el Cobro</h2>
                        <div class="space-y-4">
                            <div class="flex gap-4 items-start">
                                <div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">1</div>
                                <div>
                                    <h4 class="text-white font-bold text-lg">Entrar a Tr치mite F치cil</h4>
                                    <p class="text-sm">Ingresa a pjud.cl con tu Clave 칔nica. Busca la secci칩n "Tr치mite F치cil".</p>
                                </div>
                            </div>
                            <div class="flex gap-4 items-start">
                                <div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">2</div>
                                <div>
                                    <h4 class="text-white font-bold text-lg">Solicitar Liquidaci칩n</h4>
                                    <p class="text-sm">Pide una "Liquidaci칩n de Deuda". Esto transforma los meses impagos en un monto oficial en UTM.</p>
                                </div>
                            </div>
                            <div class="flex gap-4 items-start">
                                <div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">3</div>
                                <div>
                                    <h4 class="text-white font-bold text-lg">Pedir Retenci칩n</h4>
                                    <p class="text-sm">Una vez liquidada la deuda (y si 칠l no paga en 3 d칤as), pide "Retenci칩n de fondos bancarios" en el mismo sitio.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- TRABAJO INFORMAL -->
                    <section id="informales" class="scroll-mt-32">
                        <div class="legal-block">
                            <h3 class="text-xl font-bold text-white mb-3"><i class="fa-solid fa-mask text-slate-400 mr-2"></i> "칄l trabaja en negro / No tiene contrato"</h3>
                            <p class="text-slate-300">Este es el truco m치s viejo del mundo, pero la ley ya lo conoce.</p>
                            <ul class="list-disc ml-5 mt-4 space-y-2 text-slate-300">
                                <li><strong>Presunci칩n de Ingresos:</strong> Si no se puede probar cu치nto gana, la ley asume que gana el Sueldo M칤nimo y calcula la pensi칩n sobre eso. La deuda se acumula igual.</li>
                                <li><strong>Investigaci칩n de Gastos:</strong> El tribunal puede pedir al SII informes de sus compras o movimientos de tarjetas. Si gasta m치s de lo que declara, el juez puede fijar una pensi칩n basada en su "nivel de vida evidente".</li>
                            </ul>
                        </div>
                    </section>

                    <!-- PREGUNTAS MIEDO -->
                    <section id="miedos" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-8">Miedos Frecuentes (Respuestas Reales)</h2>
                        
                        <div class="space-y-4">
                            ${makeAccordion('m1', 'pink', 'Si lo demando, 쯠e puede quitar a los ni침os?', '<strong>NO.</strong> Es una amenaza com칰n para manipularte. El Cuidado Personal (tuici칩n) no cambia por pedir alimentos. Para quit치rtelos, 칠l tendr칤a que probar en un juicio aparte que t칰 vulneras gravemente los derechos de los ni침os (maltrato, abandono), lo cual es muy dif칤cil de probar si eres una madre presente.')}
                            
                            ${makeAccordion('m2', 'pink', 'Dice que renunciar치 al trabajo para no pagar', '<strong>Que renuncie.</strong> La deuda se sigue acumulando mes a mes. Si no paga, entra al Registro Nacional de Deudores, no podr치 sacar licencia de conducir, ni pasaporte, y le retendr치n la devoluci칩n de impuestos. Se arruina su vida financiera, no la tuya.')}
                            
                            ${makeAccordion('m3', 'pink', 'Me dijo que yo tambi칠n tengo que poner plata', '<strong>Es verdad.</strong> Ambos padres deben contribuir seg칰n sus capacidades. Pero eso no lo exime a 칠l de pagar su parte. La pensi칩n se fija en proporci칩n a los ingresos de ambos.')}
                        </div>
                    </section>
                `
            },
            papa: {
                color: 'blue',
                icon: 'mars',
                title: 'Gu칤a para Padres',
                toc: [
                    {id:'realidad', t:'La Realidad Legal'},
                    {id:'deuda-explicada', t:'Entendiendo la Deuda'},
                    {id:'visitas', t:'Visitas vs. Plata'},
                    {id:'cesantia', t:'Estoy Cesante / Quebrado'},
                    {id:'gastos-madre', t:'쮼n qu칠 gasta la plata?'},
                    {id:'defensa', t:'C칩mo defenderse'},
                    {id:'diccionario', t:'Diccionario Simple'}
                ],
                html: `
                    <!-- BLOQUE REALIDAD -->
                    <section id="realidad" class="scroll-mt-32 animate-fadeIn">
                        <div class="bg-blue-900/10 border-l-4 border-blue-500 p-6 md:p-8 rounded-r-xl">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">Hablemos claro, de hombre a hombre.</h2>
                            <p class="text-slate-300 text-lg">El sistema legal chileno puede parecer inclinado hacia las madres. A veces se siente injusto. Pero enojarse o "desaparecer" es la peor estrategia legal que puedes tomar.<br><br>
                            La deuda de alimentos <strong>nunca prescribe</strong> si no se hace el tr치mite correcto, y te perseguir치 hasta la jubilaci칩n. Aqu칤 te explicamos c칩mo regularizar tu situaci칩n para que puedas vivir tranquilo y, lo m치s importante, mantener el v칤nculo con tus hijos.</p>
                        </div>
                    </section>

                    <!-- DEUDA EXPLICADA -->
                    <section id="deuda-explicada" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6">Error #1: "Yo le compro cosas"</h2>
                        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <p class="text-xl text-white font-bold mb-4">丘멆잺 Importante:</p>
                            <p class="mb-4">Si la sentencia dice "depositar 150.000 en la cuenta del BancoEstado", <strong>tienes que depositar eso.</strong></p>
                            <ul class="space-y-2 list-none">
                                <li class="text-red-400"><i class="fa-solid fa-xmark mr-2"></i> Pagar el furg칩n escolar directo al t칤o NO cuenta como pensi칩n (a menos que el juez lo diga).</li>
                                <li class="text-red-400"><i class="fa-solid fa-xmark mr-2"></i> Comprar zapatillas o mercader칤a NO descuenta deuda.</li>
                                <li class="text-red-400"><i class="fa-solid fa-xmark mr-2"></i> Darle dinero en efectivo a ella sin recibo NO existe para el tribunal.</li>
                            </ul>
                            <p class="mt-4 text-sm text-slate-400"><strong>Consejo:</strong> Paga siempre en la cuenta oficial. Si quieres dar extra, es un regalo.</p>
                        </div>
                    </section>

                    <!-- VISITAS -->
                    <section id="visitas" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6">Visitas vs. Dinero</h2>
                        <p class="text-lg mb-4">Existe el mito de "si no pago, no veo al ni침o". <strong>FALSO.</strong></p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-slate-800/50 p-5 rounded-lg">
                                <h4 class="text-blue-400 font-bold mb-2">Relaci칩n Directa y Regular (Visitas)</h4>
                                <p class="text-sm">Es un <strong>derecho del ni침o</strong> ver a su padre, pague o no pague. Si la madre te proh칤be las visitas por deuda, ella est치 vulnerando los derechos del ni침o y puedes demandar el cumplimiento del r칠gimen de visitas (o compensaci칩n de d칤as).</p>
                            </div>
                            <div class="bg-slate-800/50 p-5 rounded-lg">
                                <h4 class="text-blue-400 font-bold mb-2">Pensi칩n de Alimentos</h4>
                                <p class="text-sm">Es un deber econ칩mico. Si no pagas, tienes sanciones financieras y de arresto, pero no pierdes autom치ticamente el derecho a ser padre.</p>
                            </div>
                        </div>
                    </section>

                    <!-- CESANT칈A -->
                    <section id="cesantia" class="scroll-mt-32">
                        <div class="legal-block border-l-blue-400">
                            <h3 class="text-xl font-bold text-white mb-3">Estoy Cesante / No tengo plata</h3>
                            <p class="text-slate-300 mb-4">Quedar sin trabajo no congela la pensi칩n autom치ticamente. La deuda sigue creciendo mes a mes.</p>
                            <p class="font-bold text-white mb-2">쯈u칠 debes hacer?</p>
                            <ol class="list-decimal ml-5 space-y-2 text-slate-300">
                                <li>Ir INMEDIATAMENTE al tribunal (o mediaci칩n).</li>
                                <li>Solicitar una <strong>Rebaja de Pensi칩n</strong> por cambio de circunstancias.</li>
                                <li>Ofrecer un monto m칤nimo que s칤 puedas pagar (aunque sea el m칤nimo legal).</li>
                            </ol>
                            <p class="mt-4 text-sm italic text-slate-500">Si te quedas callado esperando "tener plata", generar치s una deuda millonaria impagable.</p>
                        </div>
                    </section>

                    <!-- GASTOS MADRE -->
                    <section id="gastos-madre" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-8">Preguntas Inc칩modas</h2>
                        <div class="space-y-4">
                            ${makeAccordion('p1', 'blue', 'Ella gasta la pensi칩n en peluquer칤a/u침as/fiestas', 'Legalmente, quien tiene el Cuidado Personal administra los fondos. Se asume que el dinero libera sus propios fondos para otros gastos. Es muy dif칤cil que un juez fiscalice "en qu칠 se gast칩 cada peso" a menos que haya una vulneraci칩n evidente de derechos del ni침o (ej: ni침o desnutrido). Si el ni침o est치 bien, el tribunal no se meter치 en c칩mo ella administra.')}
                            
                            ${makeAccordion('p2', 'blue', 'Me funaron en Facebook', 'Las "funas" no son un mecanismo legal y pueden constituir delito de Injurias. Sin embargo, pelear por redes sociales suele ser peor. Si la funa te causa perjuicio laboral real, puedes presentar un Recurso de Protecci칩n, pero necesitas abogado.')}
                        </div>
                    </section>
                `
            }
        };

        // --- FUNCIONES DE RENDERIZADO ---

        function makeAccordion(id, color, q, a) {
            const borderColor = color === 'pink' ? 'border-pink-500' : 'border-blue-500';
            const iconColor = color === 'pink' ? 'text-pink-400' : 'text-blue-400';
            
            return `
            <div class="faq-item">
                <button onclick="toggleAccordion('${id}')" class="faq-trigger group">
                    <span class="font-bold text-slate-200 group-hover:${iconColor} transition-colors text-base md:text-lg flex items-center gap-3">
                        <i class="fa-regular fa-circle-question ${iconColor} opacity-50"></i> ${q}
                    </span>
                    <i id="icon-${id}" class="fa-solid fa-chevron-down text-slate-500 transition-transform duration-300"></i>
                </button>
                <div id="${id}" class="faq-content ${borderColor}">
                    <div class="text-reading text-slate-300 text-lg leading-relaxed">${a}</div>
                </div>
            </div>`;
        }

        function toggleAccordion(id) {
            const el = document.getElementById(id);
            const icon = document.getElementById(`icon-${id}`);
            
            if (el.style.display === 'block') {
                el.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            } else {
                el.style.display = 'block';
                el.style.animation = 'fadeIn 0.3s ease-out';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // --- SISTEMA DE NAVEGACI칍N ---

        function enterSite(profile) {
            const data = contentData[profile];
            const badge = document.getElementById('profile-badge');
            
            // Render Badge Profile
            const colorClass = profile === 'mama' ? 'text-pink-400 border-pink-500/50 bg-pink-900/20' : 'text-blue-400 border-blue-500/50 bg-blue-900/20';
            badge.innerHTML = `<span class="border ${colorClass} px-3 py-1 md:px-4 md:py-2 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-wider shadow-sm flex items-center gap-2"><i class="fa-solid fa-${data.icon}"></i> Modo ${profile === 'mama' ? 'Madre' : 'Padre'}</span>`;

            // Render TOC (Desktop & Mobile)
            const tocHTML = data.toc.map(i => `<a href="#${i.id}" onclick="closeMobileToc()" class="block py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-all border-l-2 border-transparent hover:border-${data.color}-500">${i.t}</a>`).join('');
            document.getElementById('toc-desktop').innerHTML = tocHTML;
            document.getElementById('toc-mobile').innerHTML = tocHTML;

            // Render Main Content
            const contentHTML = data.html + renderDictionary(profile); // Append Dictionary
            document.getElementById('main-content').innerHTML = contentHTML;

            // Transiciones UI
            document.getElementById('landing-section').classList.add('hidden');
            const guide = document.getElementById('guide-ui');
            guide.classList.remove('hidden');
            guide.classList.add('visible-section');
            window.scrollTo(0,0);
        }

        function renderDictionary(profile) {
            const color = profile === 'mama' ? 'pink' : 'blue';
            return `
            <section id="diccionario" class="scroll-mt-32 pt-12 border-t border-slate-800 mt-12">
                <h2 class="text-3xl font-black text-white mb-6">Diccionario "En F치cil"</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-800/40 p-4 rounded-lg">
                        <strong class="text-${color}-400 block mb-1">UTM (Unidad Tributaria Mensual)</strong>
                        <span class="text-sm text-slate-400">Es un valor en pesos que cambia cada mes. Las pensiones se fijan en UTM para que la plata no pierda valor con la inflaci칩n. Si la UTM sube, la pensi칩n sube sola.</span>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-lg">
                        <strong class="text-${color}-400 block mb-1">Cese de Alimentos</strong>
                        <span class="text-sm text-slate-400">Es el tr치mite para dejar de pagar pensi칩n legalmente (ej: cuando el hijo cumple 28 a침os). No es autom치tico, tienes que pedirlo al juez.</span>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-lg">
                        <strong class="text-${color}-400 block mb-1">Medida de Apremio</strong>
                        <span class="text-sm text-slate-400">Son los castigos por no pagar: arresto nocturno, arraigo nacional (no salir del pa칤s), retenci칩n de licencia, etc.</span>
                    </div>
                    <div class="bg-slate-800/40 p-4 rounded-lg">
                        <strong class="text-${color}-400 block mb-1">Mediaci칩n</strong>
                        <span class="text-sm text-slate-400">Una reuni칩n obligatoria antes de ir a juicio. Un profesional neutro trata de que lleguen a acuerdo sin pelear frente al juez.</span>
                    </div>
                </div>
            </section>
            `;
        }

        function exitSite() {
            document.getElementById('guide-ui').classList.add('hidden');
            document.getElementById('guide-ui').classList.remove('visible-section');
            document.getElementById('landing-section').classList.remove('hidden');
        }

        function closeMobileToc() {
            document.getElementById('mobile-toc-modal').classList.add('hidden');
        }

        // --- B칔SQUEDA IA Y LOCAL ---
        const localDB = [
            // DB mejorada con los nuevos contenidos
            {keywords: ["marihuana", "droga", "vicio"], title: "쮾asta el dinero en vicios?", text: "Situaci칩n grave. NO dejes de pagar, te perjudicas. Demanda Medida de Protecci칩n.", profile: "papa", anchor: "gastos-madre"},
            {keywords: ["negro", "contrato", "informal"], title: "Trabajo Informal", text: "La ley presume ingresos m칤nimos y el SII investiga gastos.", profile: "mama", anchor: "informales"},
            {keywords: ["cesante", "trabajo", "quiebra"], title: "Estoy Cesante", text: "La deuda sigue creciendo. Pide rebaja en tribunales YA.", profile: "papa", anchor: "cesantia"},
            {keywords: ["abuelos", "suegros"], title: "Demanda a Abuelos", text: "Si el padre no paga, pagan los abuelos (responsabilidad subsidiaria).", profile: "mama", anchor: "abuelos"}
        ];

        function handleKeyPress(e) { if(e.key === 'Enter') performSearch(); }

        async function performSearch() {
            const query = document.getElementById('ai-search-input').value.toLowerCase().trim();
            const panel = document.getElementById('ai-results-panel');
            
            if(!query) return;

            panel.innerHTML = `
                <div class="ai-result-card text-center">
                    <div class="flex flex-col items-center justify-center py-6">
                        <div class="typing-indicator mb-4"><span></span><span></span><span></span></div>
                        <p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Analizando Ley 21.484...</p>
                    </div>
                </div>`;
            panel.classList.remove('hidden');

            const localMatch = localDB.find(item => item.keywords.some(k => query.includes(k)));

            if(localMatch) {
                setTimeout(() => renderLocalResult(localMatch, panel), 600);
            } else {
                try {
                    const aiResponse = await fetchGeminiResponse(query);
                    renderAIResult(aiResponse, panel);
                } catch (error) {
                    panel.innerHTML = `<div class="ai-result-card text-red-400 p-4">Error de conexi칩n. Intenta de nuevo.</div>`;
                }
            }
        }

        function renderLocalResult(match, panel) {
            panel.innerHTML = `
                <div class="ai-result-card relative">
                     <button onclick="document.getElementById('ai-results-panel').classList.add('hidden')" class="absolute top-2 right-2 text-slate-400 hover:text-white p-2"><i class="fa-solid fa-xmark"></i></button>
                    <h3 class="text-xl font-bold text-white mb-2">${match.title}</h3>
                    <p class="text-slate-300 mb-4">${match.text}</p>
                    <button onclick="goToResult('${match.profile}', '${match.anchor}')" class="w-full bg-slate-700/50 hover:bg-slate-700 p-3 rounded-lg text-brand-purple font-bold">Ver explicaci칩n detallada</button>
                </div>
            `;
        }

        function renderAIResult(text, panel) {
            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            panel.innerHTML = `
                <div class="ai-result-card relative border-l-green-500">
                    <button onclick="document.getElementById('ai-results-panel').classList.add('hidden')" class="absolute top-2 right-2 text-slate-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
                    <div class="ai-content text-slate-200 text-sm leading-relaxed mt-2">${formattedText}</div>
                    <div class="mt-4 pt-2 border-t border-slate-700 text-[10px] text-slate-500 text-right">IA Jur칤dica (Gemini) - Referencial</div>
                </div>
            `;
        }

        function goToResult(profile, anchor) {
            enterSite(profile);
            setTimeout(() => {
                const el = document.getElementById(anchor);
                if(el) {
                    el.scrollIntoView({behavior:'smooth', block:'center'});
                    const btn = el.querySelector('button');
                    if(btn && btn.getAttribute('onclick').includes('toggleAccordion')) btn.click();
                    // Efecto visual
                    el.classList.add('bg-slate-800');
                    setTimeout(()=>el.classList.remove('bg-slate-800'), 1000);
                }
                document.getElementById('ai-results-panel').classList.add('hidden');
            }, 300);
        }

        async function fetchGeminiResponse(userQuery) {
            const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const systemPrompt = `Eres un experto legal chileno (Ley 21.484). Responde con empat칤a, en lenguaje simple (nivel 8vo b치sico), usa negritas para conceptos clave. M치ximo 100 palabras. Si preguntan deuda, menciona el Registro de Deudores.`;
            const payload = { contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
            
            const response = await fetch(endpoint, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
            const data = await response.json();
            return data.candidates?.[0]?.content?.parts?.[0]?.text || "No tengo una respuesta exacta. Consulta a un abogado.";
        }

        // --- THREE.JS BACKGROUND ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({alpha:true, antialias:true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        
        const particles = new THREE.Group();
        const geo = new THREE.SphereGeometry(0.05, 8, 8);
        const mat = new THREE.MeshBasicMaterial({color: 0x64748b});
        
        for(let i=0; i<300; i++) {
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*30);
            particles.add(mesh);
        }
        scene.add(particles);
        camera.position.z = 15;

        function animate() {
            requestAnimationFrame(animate);
            particles.rotation.y += 0.0005;
            particles.rotation.x += 0.0002;
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', ()=>{
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
