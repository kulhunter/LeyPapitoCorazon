<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ley de Responsabilidad Parental Chile | Guía Completa 2024</title>
    
    <!-- SEO METADATA -->
    <meta name="description" content="Guía definitiva sobre la Ley 21.484 de Responsabilidad Parental y Pago Efectivo de Pensiones en Chile. Procedimiento de cobro AFP, retención bancaria y registro de deudores.">
    <meta name="keywords" content="ley papito corazón, retiro afp pensión alimentos, registro nacional de deudores, ley 21484, cobro pensión alimentos chile, cuidado personal, relación directa y regular">
    <meta name="author" content="Defensa Parental Chile">
    
    <!-- SCHEMA.ORG (Article + FAQ) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "headline": "Guía Definitiva de la Ley de Responsabilidad Parental en Chile",
      "description": "Explicación detallada de los mecanismos de cobro de pensión de alimentos mediante retención bancaria y fondos de AFP según la Ley 21.484.",
      "author": {
        "@type": "Organization",
        "name": "Defensa Parental Chile"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Defensa Parental Chile"
      }
    }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7868880098336635" crossorigin="anonymous"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                    },
                    colors: {
                        dark: '#0f172a', 
                        neonBlue: '#3b82f6',
                        neonPurple: '#a855f7',
                        neonPink: '#ec4899',
                    },
                    fontSize: {
                        'md': '1.05rem',
                        'lg': '1.15rem',
                        'xl': '1.25rem',
                        '2xl': '1.5rem',
                        '3xl': '2rem',
                    }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body { margin: 0; background-color: #020617; color: #f1f5f9; overflow-x: hidden; }
        
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 80%);
        }

        .glass-panel {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .text-gradient {
            background: linear-gradient(135deg, #60a5fa 0%, #c084fc 50%, #f472b6 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Scrollbar personalizada */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        .nav-link.active {
            color: #fff;
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #a855f7;
        }

        /* Utilidades */
        .hidden-section { display: none; }
        .visible-section { display: block; animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Estilos de contenido enriquecido */
        .content-body h3 { font-size: 1.75rem; font-weight: 800; margin-top: 2.5rem; margin-bottom: 1rem; color: #fff; }
        .content-body h4 { font-size: 1.4rem; font-weight: 700; margin-top: 1.5rem; margin-bottom: 0.8rem; color: #e2e8f0; display: flex; align-items: center; gap: 0.5rem; }
        .content-body p { margin-bottom: 1.2rem; line-height: 1.8; color: #cbd5e1; font-size: 1.15rem; }
        .content-body ul { margin-bottom: 1.5rem; list-style: none; padding-left: 0; }
        .content-body li { margin-bottom: 0.8rem; padding-left: 1.5rem; position: relative; line-height: 1.6; font-size: 1.1rem; }
        .content-body li::before { content: "•"; color: #a855f7; position: absolute; left: 0; font-weight: bold; font-size: 1.5rem; line-height: 1.2; }
        
        /* Highlight box */
        .highlight-box { background: rgba(59, 130, 246, 0.1); border-left: 4px solid #3b82f6; padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; margin: 2rem 0; }
        .warning-box { background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; margin: 2rem 0; }
        .success-box { background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; padding: 1.5rem; border-radius: 0 0.5rem 0.5rem 0; margin: 2rem 0; }

        .sticky-nav {
            position: sticky;
            top: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="antialiased">

    <!-- 3D Background -->
    <div id="canvas-container"></div>

    <!-- MAIN UI WRAPPER -->
    <div class="relative z-10 w-full min-h-screen flex flex-col">

        <!-- NAVBAR GLOBAL -->
        <nav class="w-full glass-panel border-b border-white/10 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center gap-2 cursor-pointer" onclick="goHome()">
                    <i class="fa-solid fa-scale-balanced text-2xl text-neonPurple"></i>
                    <span class="font-black text-xl tracking-tight text-white">LEY<span class="text-neonBlue">RESPONSABLE</span></span>
                </div>
                <div class="text-xs md:text-sm font-semibold bg-white/10 px-3 py-1 rounded-full text-gray-300">
                    <i class="fa-solid fa-check-circle text-green-400 mr-1"></i> Actualizado Ley 21.484
                </div>
            </div>
        </nav>

        <!-- SECCIÓN 1: HOME (SELECCIÓN DE PERFIL) -->
        <header id="intro-section" class="flex flex-col items-center justify-center min-h-[90vh] text-center px-4 py-12 relative">
            
            <div class="animate-slide-up max-w-5xl mx-auto space-y-8">
                <span class="text-neonPurple font-bold tracking-widest uppercase text-sm md:text-base">Guía Definitiva 2024</span>
                <h1 class="text-5xl md:text-7xl lg:text-8xl font-black leading-none tracking-tight">
                    LA VERDAD SOBRE<br>
                    <span class="text-gradient">TU FAMILIA</span>
                </h1>
                <p class="text-xl md:text-2xl text-gray-300 font-light max-w-3xl mx-auto leading-relaxed">
                    La "Ley Papito Corazón" (21.484) cambió las reglas del juego en Chile. 
                    <br><strong class="text-white font-medium">Se acabaron las excusas.</strong>
                    Elige tu perfil para entender cómo te afecta realmente.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-4xl mx-auto mt-12">
                    <!-- Botón Mamá -->
                    <button onclick="loadGuide('mama')" class="group relative overflow-hidden rounded-3xl glass-panel p-1 text-left transition-all hover:scale-[1.02] duration-300 hover:shadow-[0_0_40px_rgba(236,72,153,0.3)]">
                        <div class="absolute inset-0 bg-gradient-to-br from-pink-600/30 to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10 p-8 h-full flex flex-col justify-between min-h-[250px]">
                            <div>
                                <i class="fa-solid fa-venus text-5xl text-pink-500 mb-6"></i>
                                <h2 class="text-4xl font-black text-white mb-2">SOY MAMÁ</h2>
                                <p class="text-pink-200 text-lg font-medium">Quiero cobrar la pensión y proteger a mi hijo.</p>
                            </div>
                            <div class="mt-6 flex items-center text-white font-bold text-lg">
                                LEER GUÍA COMPLETA <i class="fa-solid fa-arrow-right ml-3 group-hover:translate-x-2 transition-transform"></i>
                            </div>
                        </div>
                    </button>

                    <!-- Botón Papá -->
                    <button onclick="loadGuide('papa')" class="group relative overflow-hidden rounded-3xl glass-panel p-1 text-left transition-all hover:scale-[1.02] duration-300 hover:shadow-[0_0_40px_rgba(59,130,246,0.3)]">
                        <div class="absolute inset-0 bg-gradient-to-br from-blue-600/30 to-transparent opacity-50 group-hover:opacity-100 transition-opacity"></div>
                        <div class="relative z-10 p-8 h-full flex flex-col justify-between min-h-[250px]">
                            <div>
                                <i class="fa-solid fa-mars text-5xl text-blue-500 mb-6"></i>
                                <h2 class="text-4xl font-black text-white mb-2">SOY PAPÁ</h2>
                                <p class="text-blue-200 text-lg font-medium">Quiero cumplir, ver a mi hijo y entender mis derechos.</p>
                            </div>
                            <div class="mt-6 flex items-center text-white font-bold text-lg">
                                LEER GUÍA COMPLETA <i class="fa-solid fa-arrow-right ml-3 group-hover:translate-x-2 transition-transform"></i>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </header>

        <!-- SECCIÓN 2: GUÍA COMPLETA (READER VIEW) -->
        <div id="guide-section" class="hidden-section w-full max-w-7xl mx-auto px-4 py-8">
            
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
                
                <!-- SIDEBAR DE NAVEGACIÓN (ÍNDICE) -->
                <aside class="lg:col-span-3 hidden lg:block">
                    <div class="sticky-nav glass-panel rounded-2xl p-6">
                        <h3 class="text-white font-bold text-lg mb-4 uppercase tracking-wider border-b border-white/10 pb-2">Índice</h3>
                        <nav class="flex flex-col space-y-1" id="toc-desktop">
                            <!-- Inyectado por JS -->
                        </nav>
                        
                        <div class="mt-8 pt-6 border-t border-white/10">
                            <button onclick="goHome()" class="text-gray-400 hover:text-white flex items-center gap-2 text-sm font-semibold transition-colors">
                                <i class="fa-solid fa-arrow-left"></i> Volver al Inicio
                            </button>
                        </div>
                    </div>
                </aside>

                <!-- MENÚ MÓVIL (Sticky Top) -->
                <div class="lg:hidden sticky top-[73px] z-40 bg-[#0f172a]/95 backdrop-blur-md border-b border-white/10 -mx-4 px-4 py-3 mb-6 overflow-x-auto whitespace-nowrap custom-scrollbar" id="toc-mobile">
                     <!-- Inyectado por JS -->
                </div>

                <!-- CONTENIDO PRINCIPAL -->
                <article class="lg:col-span-9 glass-panel rounded-3xl p-6 md:p-12 min-h-screen content-body" id="article-content">
                    <!-- Contenido inyectado por JS -->
                </article>

            </div>
        </div>

    </div>

    <!-- BASE DE DATOS DE CONTENIDO (HTML ENRIQUECIDO) -->
    <script>
        const contentData = {
            mama: `
                <header class="mb-12 border-b border-white/10 pb-8">
                    <span class="text-pink-500 font-bold tracking-wider uppercase mb-2 block">Guía Legal Actualizada</span>
                    <h1 class="text-4xl md:text-6xl font-black text-white mb-4">Manual de Cobro y Defensa para Madres</h1>
                    <p class="text-xl text-gray-300">Entiende la Ley 21.484, cómo activar el pago por AFP y cómo defender el patrimonio de tu hijo sin miedo.</p>
                </header>

                <section id="contexto" class="mb-16">
                    <h3>1. El Nuevo Paradigma: El Estado Busca el Dinero</h3>
                    <p>Antes, tú tenías que hacer de investigadora privada: buscar dónde trabajaba el padre, si tenía auto, si tenía casa. <strong>Eso se acabó.</strong></p>
                    <p>La Ley de Responsabilidad Parental (Ley 21.484) establece que si existe una deuda de alimentos decretada por un tribunal, es el Estado (a través de los Tribunales de Familia) el encargado de investigar el patrimonio del deudor.</p>
                    <div class="highlight-box">
                        <h4 class="text-blue-300 m-0">Dato Clave</h4>
                        <p class="m-0 text-sm">Ya no es necesario que demandes "Cumplimiento" eternamente. Ahora existen procedimientos especiales que se activan cuando hay deuda.</p>
                    </div>
                </section>

                <section id="retencion-bancaria" class="mb-16">
                    <h3>2. Procedimiento Especial: Búsqueda de Fondos</h3>
                    <p>Si el padre adeuda <strong class="text-white">una sola mensualidad</strong>, puedes solicitar al Tribunal que inicie el "Procedimiento Especial".</p>
                    <h4>¿Qué hace el Tribunal?</h4>
                    <ul>
                        <li>Consulta automáticamente a la Comisión para el Mercado Financiero (CMF), al SII y a otros organismos.</li>
                        <li>Busca cuentas bancarias, instrumentos de inversión, devoluciones de impuestos y créditos.</li>
                        <li>Si encuentra dinero, ordena al banco <strong>retener</strong> esos fondos y transferirlos a la cuenta de la pensión.</li>
                    </ul>
                    <p>Todo esto ocurre en un plazo máximo de días acotados por la ley. Ya no hay secreto bancario para los deudores de alimentos.</p>
                </section>

                <section id="pago-afp" class="mb-16">
                    <h3>3. El Pago con Fondos de AFP (Procedimiento Extraordinario)</h3>
                    <p>Este es el punto más fuerte de la nueva ley. Si el deudor no tiene dinero en los bancos (o es insuficiente), se puede perseguir su ahorro previsional.</p>
                    
                    <div class="warning-box">
                        <h4 class="text-red-300">Requisitos Obligatorios</h4>
                        <ul>
                            <li>Que existan <strong>3 pensiones impagas</strong> (continuas o discontinuas).</li>
                            <li>Que no se hayan encontrado fondos suficientes en cuentas bancarias (paso anterior).</li>
                        </ul>
                    </div>

                    <h4>Límites del Retiro</h4>
                    <p>No se saca todo el dinero de la AFP indiscriminadamente. La ley fija límites según los años que le falten para jubilar:</p>
                    <ul>
                        <li>Si le faltan 15 a 30 años: Puede sacar hasta el <strong>50%</strong> de sus fondos.</li>
                        <li>Si le faltan menos de 15 años: Puede sacar hasta el <strong>80%</strong>.</li>
                        <li>Si ya está pensionado: Hasta el <strong>90%</strong>.</li>
                    </ul>
                </section>

                <section id="registro-deudores" class="mb-16">
                    <h3>4. Registro Nacional de Deudores</h3>
                    <p>Si debe 3 meses continuos o 5 discontinuos, ingresa al Registro. Estar aquí es la "muerte civil" financiera.</p>
                    <h4>Consecuencias Inmediatas:</h4>
                    <ul>
                        <li><strong>Licencia de Conducir:</strong> No podrá renovarla ni sacarla.</li>
                        <li><strong>Pasaporte:</strong> No podrá emitirlo.</li>
                        <li><strong>Venta de Inmuebles/Vehículos:</strong> El Conservador de Bienes Raíces o Registro Civil inscribirá la venta SOLO si se paga la deuda de alimentos con las ganancias.</li>
                        <li><strong>Devolución de Impuestos:</strong> Tesorería retendrá su devolución de renta.</li>
                        <li><strong>Créditos Bancarios:</strong> Si pide un crédito de consumo de 50 UF o más, el banco debe retener parte del dinero para pagar la deuda.</li>
                    </ul>
                </section>

                <section id="visitas-miedos" class="mb-16">
                    <h3>5. Visitas y Tus Miedos Frecuentes</h3>
                    <p>Muchas madres temen exigir el pago por miedo a represalias con el niño.</p>
                    
                    <div class="success-box">
                        <h4 class="text-green-300">La Verdad Legal</h4>
                        <p><strong>El dinero NO compra derechos sobre el niño.</strong></p>
                        <p>Que él pague la pensión (incluso si es a la fuerza por AFP) no le da derecho automático a pedir el Cuidado Personal (tuición) ni a llevarse al niño cuando quiera. Son carriles separados.</p>
                    </div>

                    <p>Si él amenaza con "quitarte al niño" porque lo demandaste, mantén la calma. Los Tribunales de Familia saben que esas demandas suelen ser represalias. Lo que importa es quién ha cuidado al niño diariamente (tú) y su estabilidad emocional.</p>
                </section>
            `,
            papa: `
                <header class="mb-12 border-b border-white/10 pb-8">
                    <span class="text-blue-500 font-bold tracking-wider uppercase mb-2 block">Guía Legal Actualizada</span>
                    <h1 class="text-4xl md:text-6xl font-black text-white mb-4">Manual de Cumplimiento y Derechos del Padre</h1>
                    <p class="text-xl text-gray-300">Cómo cumplir con la ley, evitar embargos, regularizar tu situación y, lo más importante, asegurar tu relación con tu hijo.</p>
                </header>

                <section id="obligacion-pago" class="mb-16">
                    <h3>1. La Obligación de Pagar: Sin Excusas</h3>
                    <p>La pensión de alimentos no es opcional ni un favor. Es un derecho humano de tu hijo. Con la Ley 21.484, el sistema para cobrar se volvió automático y muy eficaz.</p>
                    <div class="warning-box">
                        <h4 class="text-red-300">¡Cuidado con los pagos informales!</h4>
                        <p class="m-0">Si compras ropa, pagas el colegio directo o le pasas efectivo a la madre, <strong>eso NO es pensión ante la ley</strong>. Para el tribunal, sigues debiendo dinero. Debes depositar SIEMPRE en la cuenta de ahorro del BancoEstado abierta por el tribunal.</p>
                    </div>
                </section>

                <section id="consecuencias-deuda" class="mb-16">
                    <h3>2. Si No Pagas: Consecuencias Reales</h3>
                    <p>Olvídate del "arresto nocturno" como única medida. Ahora te tocan el bolsillo directamente.</p>
                    <h4>Mecanismos Automáticos:</h4>
                    <ul>
                        <li><strong>Retención Bancaria:</strong> El tribunal puede ordenar a todos los bancos informar tus saldos y retener el dinero sin previo aviso.</li>
                        <li><strong>Fondos AFP:</strong> Si debes más de 3 pensiones, pueden sacar dinero de tu cuenta de capitalización individual, afectando tu jubilación futura.</li>
                        <li><strong>Registro de Deudores:</strong> Si entras aquí, no podrás renovar licencia de conducir ni pasaporte. Además, si vendes tu auto o casa, te retendrán la ganancia.</li>
                    </ul>
                </section>

                <section id="derecho-relacion" class="mb-16">
                    <h3>3. Tu Derecho a la Relación Directa y Regular (Visitas)</h3>
                    <p>Muchos padres creen que son solo un "cajero automático". La ley no dice eso. Tu hijo tiene derecho a tener un padre presente.</p>
                    <p>La <strong>Relación Directa y Regular</strong> es un derecho/deber. Si la madre te impide ver al niño injustificadamente, debes actuar legalmente, no dejar de pagar.</p>
                    
                    <div class="highlight-box">
                        <h4 class="text-blue-300">¿Qué hacer si obstruyen las visitas?</h4>
                        <ol class="list-decimal pl-4 space-y-2 mt-2">
                            <li>Acude a Carabineros a dejar una <strong>Constancia</strong> por cada incumplimiento.</li>
                            <li>Solicita en el Tribunal "Compensación de días" (recuperar el tiempo perdido).</li>
                            <li>Solicita "Apremio" (multas) para la madre por desacato.</li>
                        </ol>
                    </div>
                </section>

                <section id="cuidado-compartido" class="mb-16">
                    <h3>4. Cuidado Personal Compartido</h3>
                    <p>La Ley 20.680 introdujo la corresponsabilidad. Si quieres criar activamente (no solo visitar fin de semana por medio), puedes solicitar el Cuidado Personal Compartido.</p>
                    <p>Esto implica que el niño vive tiempos similares con ambos. Requiere que vivas cerca, tengas una relación civilizada con la madre y condiciones habitacionales adecuadas para el niño.</p>
                </section>

                <section id="mitos-padres" class="mb-16">
                    <h3>5. Mitos que debes olvidar</h3>
                    <ul>
                        <li><strong>"Si estoy cesante no pago":</strong> FALSO. La deuda se acumula igual. Si quedas sin trabajo, debes demandar <strong class="text-white">Rebaja de Alimentos</strong> inmediatamente.</li>
                        <li><strong>"Ella gasta la plata en ella":</strong> La ley asume que quien vive con el niño cubre gastos de vivienda y alimentación que tú no ves. Enfócate en que a tu hijo no le falte lo esencial.</li>
                    </ul>
                </section>
            `
        };

        const tocData = {
            mama: [
                { id: "contexto", text: "1. Nuevo Paradigma" },
                { id: "retencion-bancaria", text: "2. Retención Bancaria" },
                { id: "pago-afp", text: "3. Pago con AFP" },
                { id: "registro-deudores", text: "4. Registro de Deudores" },
                { id: "visitas-miedos", text: "5. Miedos y Visitas" }
            ],
            papa: [
                { id: "obligacion-pago", text: "1. Obligación de Pago" },
                { id: "consecuencias-deuda", text: "2. Consecuencias Deuda" },
                { id: "derecho-relacion", text: "3. Derecho a Visitas" },
                { id: "cuidado-compartido", text: "4. Cuidado Compartido" },
                { id: "mitos-padres", text: "5. Mitos Comunes" }
            ]
        };

        function loadGuide(profile) {
            // 1. Transición UI
            document.getElementById('intro-section').classList.add('hidden-section');
            document.getElementById('guide-section').classList.remove('hidden-section');
            document.getElementById('guide-section').classList.add('visible-section');
            
            // 2. Inyectar Contenido
            document.getElementById('article-content').innerHTML = contentData[profile];

            // 3. Generar Índice (Desktop)
            const tocDesktop = document.getElementById('toc-desktop');
            tocDesktop.innerHTML = tocData[profile].map(item => 
                `<a href="#${item.id}" class="nav-link block py-2 px-4 text-gray-400 hover:text-white hover:bg-white/5 rounded-r-lg text-sm transition-all">${item.text}</a>`
            ).join('');

            // 4. Generar Índice (Móvil)
            const tocMobile = document.getElementById('toc-mobile');
            tocMobile.innerHTML = tocData[profile].map(item => 
                `<a href="#${item.id}" class="inline-block px-4 py-2 mr-2 bg-white/10 rounded-full text-sm text-white border border-white/10">${item.text}</a>`
            ).join('');

            // 5. Scroll to top
            window.scrollTo(0, 0);

            // 6. Activar Intersection Observer para el Índice
            setupScrollSpy();
        }

        function goHome() {
            document.getElementById('guide-section').classList.remove('visible-section');
            document.getElementById('guide-section').classList.add('hidden-section');
            
            document.getElementById('intro-section').classList.remove('hidden-section');
            // Pequeño hack para reiniciar la animación
            const intro = document.getElementById('intro-section');
            intro.style.animation = 'none';
            intro.offsetHeight; /* trigger reflow */
            intro.style.animation = null; 
        }

        function setupScrollSpy() {
            const sections = document.querySelectorAll('section');
            const navLinks = document.querySelectorAll('.nav-link');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Remover clase activa de todos
                        navLinks.forEach(link => link.classList.remove('active'));
                        // Agregar clase activa al correspondiente
                        const id = entry.target.getAttribute('id');
                        const activeLink = document.querySelector(`.nav-link[href="#${id}"]`);
                        if (activeLink) activeLink.classList.add('active');
                    }
                });
            }, { rootMargin: '-20% 0px -60% 0px' }); // Ajuste para detectar mejor al leer

            sections.forEach(section => observer.observe(section));
        }

    </script>

    <!-- 3D SCENE (Fondo Sutil) -->
    <script>
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        // Color de fondo oscuro sólido para evitar banding excesivo
        
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.z = 25;

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // Geometría flotante
        const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
        const material = new THREE.MeshBasicMaterial({ 
            color: 0x3b82f6, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.05 
        });
        const torusKnot = new THREE.Mesh(geometry, material);
        scene.add(torusKnot);

        // Partículas ambiente
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 800;
        const posArray = new Float32Array(particlesCount * 3);
        
        for(let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 80;
        }
        
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.15,
            color: 0xffffff,
            transparent: true,
            opacity: 0.2
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // Animación Loop
        function animate() {
            requestAnimationFrame(animate);
            torusKnot.rotation.x += 0.001;
            torusKnot.rotation.y += 0.002;
            particlesMesh.rotation.y -= 0.0005;
            renderer.render(scene, camera);
        }
        animate();

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
