<!DOCTYPE html>
<html lang="es-CL">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ley Papito Coraz칩n | Gu칤a Legal y Emocional Chile</title>
    
    <!-- SEO METADATA -->
    <meta name="description" content="Gu칤a completa Ley 21.484. Inteligencia Artificial experta en legislaci칩n chilena (BCN). Respuestas sobre pensi칩n, visitas, deudas y conexi칩n con derecho penal y laboral.">
    <meta name="keywords" content="ley papito corazon, pensi칩n alimentos chile, registro nacional de deudores, retenci칩n afp, ley 21484, bcn chile, c칩digo civil, c칩digo penal, violencia intrafamiliar">
    <meta name="author" content="solucionador.cl">
    <meta property="og:title" content="Ley Papito Coraz칩n: Inteligencia Legal Chilena">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Lato:wght@300;400;700&family=Merriweather:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet">
    
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <!-- AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7868880098336635" crossorigin="anonymous"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        body: ['Lato', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a', 950: '#020617' },
                        brand: { purple: '#8b5cf6', pink: '#ec4899', blue: '#3b82f6', gold: '#f59e0b', green: '#10b981' }
                    },
                    animation: { 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } } }
                }
            }
        }
    </script>

    <style>
        html { scroll-behavior: smooth; }
        body { margin: 0; background-color: #0f172a; color: #f1f5f9; overflow-x: hidden; font-family: 'Lato', sans-serif; }
        
        #canvas-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 30%, #1e293b 0%, #0f172a 100%);
        }

        h1, h2, h3 { font-family: 'Montserrat', sans-serif; }
        p, li { font-family: 'Lato', sans-serif; font-size: 1.05rem; line-height: 1.8; color: #cbd5e1; }
        .text-reading { font-family: 'Merriweather', serif; }

        .ai-input-wrapper {
            position: relative;
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .ai-input-wrapper:focus-within {
            border-color: #ec4899;
            box-shadow: 0 0 25px rgba(236, 72, 153, 0.2);
            background: rgba(30, 41, 59, 0.9);
        }

        .ai-result-card {
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #8b5cf6;
            padding: 1.5rem;
            border-radius: 12px;
            margin-top: 1rem;
            animation: slideUp 0.3s ease-out;
            max-height: 70vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hidden { display: none !important; }
        .visible-section { display: block !important; animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.99); } to { opacity: 1; transform: scale(1); } }
        
        .legal-block { 
            background: rgba(51, 65, 85, 0.3); padding: 1.5rem; margin: 1.5rem 0; 
            border-radius: 12px; border-left: 4px solid #94a3b8;
        }

        .faq-trigger {
            width: 100%; text-align: left; padding: 1.25rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px;
            display: flex; justify-content: space-between; items-center;
            transition: all 0.2s;
        }
        .faq-trigger:hover { background: rgba(30, 41, 59, 0.8); border-color: rgba(255,255,255,0.1); }
        .faq-content { display: none; padding: 1.5rem; border-left: 2px solid #475569; margin-left: 1rem; margin-top: 0.5rem; color: #cbd5e1; }
        
        .gradient-title {
            background: linear-gradient(135deg, #ffffff 0%, #d8b4fe 50%, #f472b6 100%);
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }

        .mobile-toc-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 100;
            background: #8b5cf6; color: white; border-radius: 50%; width: 50px; height: 50px;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .attribution-footer {
            margin-top: 4rem; padding-bottom: 2rem; text-align: center;
            font-size: 0.85rem; color: #64748b;
        }
        .attribution-footer a { color: #94a3b8; text-decoration: none; font-weight: bold; }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        
        .typing-indicator span {
            display: inline-block; width: 8px; height: 8px;
            background-color: #a855f7; border-radius: 50%;
            animation: typing 1s infinite; margin: 0 2px;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes typing { 0%, 100% { transform: translateY(0); opacity: 0.5; } 50% { transform: translateY(-5px); opacity: 1; } }
    </style>
</head>
<body class="antialiased selection:bg-purple-500 selection:text-white">

    <div id="canvas-container"></div>

    <div id="landing-section" class="min-h-screen flex flex-col items-center justify-center p-4 relative z-10">
        
        <div class="mb-8 animate-float">
            <span class="bg-slate-800/80 backdrop-blur-sm border border-slate-600 px-5 py-2 rounded-full text-xs md:text-sm font-bold tracking-wide text-white shadow-lg flex items-center gap-2">
                <i class="fa-solid fa-scale-balanced text-brand-green"></i>
                IA Experta en Legislaci칩n Chilena (BCN) 游뻟릖
            </span>
        </div>

        <h1 class="text-5xl md:text-8xl font-black text-center leading-tight mb-4 tracking-tight">
            LEY PAPITO<br>
            <span class="gradient-title">CORAZ칍N</span>
        </h1>
        
        <p class="text-slate-300 mb-10 text-center max-w-2xl text-lg md:text-xl font-light leading-relaxed">
            La ansiedad viene de no saber. Pregunta a nuestra <strong>IA Jurista</strong> conectada con el derecho civil, penal y de familia.
        </p>

        <!-- INPUT IA -->
        <div class="w-full max-w-2xl relative z-50 mb-12">
            <div class="ai-input-wrapper flex items-center p-2">
                <div class="pl-4 pr-3 text-brand-purple text-2xl">
                    <i class="fa-solid fa-gavel"></i>
                </div>
                <input type="text" id="ai-search-input" 
                    placeholder="Escribe tu caso: 'me peg칩 y no paga', 'me despidieron', 'el ni침o vive con la abuela'..." 
                    class="w-full bg-transparent border-none outline-none text-white placeholder-slate-400 text-lg py-3 font-medium truncate"
                    onkeypress="handleKeyPress(event)" autocomplete="off">
                <button onclick="performSearch()" class="bg-gradient-to-r from-violet-600 to-fuchsia-600 text-white p-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-violet-500/30 transform hover:scale-105 active:scale-95 font-bold">
                    Consultar IA
                </button>
            </div>
            <div id="ai-results-panel" class="hidden absolute top-full left-0 w-full mt-4 z-50"></div>
        </div>

        <div class="w-full max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-6 px-2">
            <!-- TARJETA MAM츼 -->
            <button onclick="enterSite('mama')" class="group relative overflow-hidden bg-slate-800/40 hover:bg-slate-800/60 border border-slate-700/50 hover:border-pink-500/50 p-8 rounded-3xl text-left transition-all duration-300">
                <div class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fa-solid fa-venus text-9xl text-pink-500"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 group-hover:text-pink-400 transition-colors">SOY MAM츼</h3>
                <p class="text-pink-300 font-bold text-sm uppercase tracking-wider mb-4">"Necesito que pague / Proteger al ni침o"</p>
                <div class="mt-6 flex items-center gap-2 text-pink-400 text-sm font-bold group-hover:underline decoration-pink-500 underline-offset-4">
                    Entrar a la gu칤a <i class="fa-solid fa-arrow-right"></i>
                </div>
            </button>
            <!-- TARJETA PAP츼 -->
            <button onclick="enterSite('papa')" class="group relative overflow-hidden bg-slate-800/40 hover:bg-slate-800/60 border border-slate-700/50 hover:border-blue-500/50 p-8 rounded-3xl text-left transition-all duration-300">
                <div class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fa-solid fa-mars text-9xl text-blue-500"></i>
                </div>
                <h3 class="text-2xl font-black text-white mb-2 group-hover:text-blue-400 transition-colors">SOY PAP츼</h3>
                <p class="text-blue-300 font-bold text-sm uppercase tracking-wider mb-4">"Quiero ver a mi hijo / Regularizar deuda"</p>
                <div class="mt-6 flex items-center gap-2 text-blue-400 text-sm font-bold group-hover:underline decoration-blue-500 underline-offset-4">
                    Entrar a la gu칤a <i class="fa-solid fa-arrow-right"></i>
                </div>
            </button>
        </div>

        <div class="attribution-footer absolute bottom-0 w-full">
            <a href="https://solucionador.cl" target="_blank" class="hover:text-brand-purple transition-colors">Tecnolog칤a desarrollada por <strong>solucionador.cl</strong></a>
        </div>
    </div>

    <!-- GUIDE INTERFACE -->
    <div id="guide-ui" class="hidden min-h-screen bg-[#0f172a] relative z-20">
        <header class="fixed top-0 w-full bg-[#0f172a]/95 backdrop-blur-md border-b border-slate-800 z-40 px-4 md:px-8 py-4 flex justify-between items-center shadow-lg">
            <button onclick="exitSite()" class="text-slate-400 hover:text-white font-bold text-sm uppercase flex items-center gap-2 transition-colors">
                <div class="bg-slate-800 p-2 rounded-full"><i class="fa-solid fa-arrow-left"></i></div>
                <span class="hidden md:inline">Volver</span>
            </button>
            <div id="profile-badge"></div>
        </header>

        <div class="max-w-7xl mx-auto pt-24 px-4 pb-32 grid grid-cols-1 lg:grid-cols-12 gap-8 md:gap-12">
            <aside class="lg:col-span-3 hidden lg:block">
                <div class="sticky top-28">
                    <h4 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">Contenido de la Gu칤a</h4>
                    <nav id="toc-desktop" class="space-y-1 max-h-[75vh] overflow-y-auto custom-scrollbar pr-2 border-l border-slate-800 pl-4"></nav>
                </div>
            </aside>
            <main id="main-content" class="lg:col-span-9 space-y-12 md:pr-10"></main>
        </div>

        <button id="mobile-toc-toggle" class="lg:hidden mobile-toc-btn shadow-lg" onclick="document.getElementById('mobile-toc-modal').classList.remove('hidden')">
            <i class="fa-solid fa-list-ul"></i>
        </button>

        <div id="mobile-toc-modal" class="hidden fixed inset-0 z-[150] bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center p-4">
            <div class="bg-slate-900 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-white font-bold text-lg">칈ndice de Temas</h3>
                    <button onclick="document.getElementById('mobile-toc-modal').classList.add('hidden')" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>
                <nav id="toc-mobile" class="space-y-3 overflow-y-auto max-h-[60vh]"></nav>
            </div>
        </div>

        <div class="attribution-footer">
            <a href="https://solucionador.cl" target="_blank">Desarrollado con 仇벒잺 y 丘뒲잺 por <strong>solucionador.cl</strong></a>
        </div>
    </div>

    <script>
        const apiKey = ""; 

        // --- NIVEL 1: BASE DE DATOS LOCAL EXPANDIDA (Prioridad M치xima) ---
        const localDB = [
            {
                keywords: ["abuela", "abandonado", "vive con", "tuicion", "cuidado personal"],
                title: "쯈ui칠n tiene el cuidado del ni침o?",
                text: "Si el ni침o vive con la abuela, el padre/madre que paga pensi칩n puede demandar el <strong>Cuidado Personal (Tuici칩n)</strong> o solicitar que la pensi칩n se pague directamente a quien lo cuida (la abuela). <br><br><strong>Ojo legal:</strong> Dejar al ni침o con la abuela para trabajar NO es abandono. El abandono legal (C칩digo Penal) requiere poner en peligro su vida o salud. Para obtener la tuici칩n, debes ir a Mediaci칩n primero.",
                profile: "papa", anchor: "defensa"
            },
            {
                keywords: ["vicio", "droga", "marihuana", "alcohol", "gastos"],
                title: "쯄al uso del dinero?",
                text: "La ley asume que quien tiene al ni침o administra los gastos. Sin embargo, si existen pruebas graves de que el dinero se usa en drogas o vicios que ponen en riesgo al menor, se puede solicitar una <strong>Medida de Protecci칩n</strong> en Tribunales de Familia para cambiar quien recibe el dinero o incluso el cuidado personal.",
                profile: "papa", anchor: "gastos-madre"
            },
            {keywords: ["negro", "informal", "sin contrato"], title: "Trabajo Informal", text: "La ley 21.484 permite al juez 'presumir' ingresos. Si no tiene contrato, se asume que gana el sueldo m칤nimo y la deuda se calcula sobre eso. El tribunal cruzar치 datos con el SII para ver sus gastos.", profile: "mama", anchor: "informales"},
            {keywords: ["cesante", "despido", "finiquito"], title: "Estoy Cesante", text: "La deuda NO se congela sola. Debes demandar rebaja de pensi칩n inmediatamente. Si te despidieron, te pueden retener pensi칩n del finiquito (Derecho Laboral).", profile: "papa", anchor: "cesantia"},
            {keywords: ["abuelos", "suegros"], title: "Responsabilidad de Abuelos", text: "Si el padre/madre no paga y no tiene bienes, la ley permite demandar a los abuelos (deuda subsidiaria).", profile: "mama", anchor: "abuelos"}
        ];

        // --- CONTENIDO EST츼TICO DE LA GU칈A ---
        const contentData = {
            mama: {
                color: 'pink',
                icon: 'venus',
                title: 'Gu칤a para Madres',
                toc: [
                    {id:'empatia', t:'Primero: Respira'},
                    {id:'ley21484', t:'La Nueva Ley (Autom치tica)'},
                    {id:'cobro-paso', t:'Paso a Paso: C칩mo Cobrar'},
                    {id:'afp', t:'La Carta de la AFP'},
                    {id:'informales', t:'쯏 si trabaja en negro?'},
                    {id:'abuelos', t:'Demandar a los Abuelos'},
                    {id:'miedos', t:'Miedos Frecuentes'},
                    {id:'diccionario', t:'Diccionario Simple'}
                ],
                html: `
                    <section id="empatia" class="scroll-mt-32 animate-fadeIn">
                        <div class="bg-pink-900/10 border-l-4 border-pink-500 p-6 md:p-8 rounded-r-xl">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">La Ley cambi칩 a tu favor.</h2>
                            <p class="text-slate-300 text-lg">Ya no est치s sola persiguiendo deudores. El Estado ahora tiene la obligaci칩n de investigar el patrimonio. Te explicamos c칩mo usar estas herramientas.</p>
                        </div>
                    </section>
                    <section id="ley21484" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6"> <span class="text-pink-500">#1</span> Interconexi칩n (Bancos y SII)</h2>
                        <p class="mb-4">El Tribunal de Familia ahora se conecta digitalmente con la CMF (Bancos), el SII (Impuestos) y las AFP. Si 칠l tiene plata en <strong>cualquier</strong> lado legal, el tribunal lo sabr치 sin que t칰 tengas que investigar.</p>
                    </section>
                    <section id="cobro-paso" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6"><span class="text-pink-500">#2</span> C칩mo activar el cobro</h2>
                        <div class="space-y-4">
                            <div class="flex gap-4 items-start"><div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">1</div><div><h4 class="text-white font-bold text-lg">Tr치mite F치cil Pjud.cl</h4><p class="text-sm">Entra con Clave 칔nica y busca "Liquidaci칩n de Deuda".</p></div></div>
                            <div class="flex gap-4 items-start"><div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">2</div><div><h4 class="text-white font-bold text-lg">Retenci칩n Bancaria</h4><p class="text-sm">Si hay deuda, pide al tribunal que "Retenga fondos" de sus cuentas.</p></div></div>
                            <div class="flex gap-4 items-start"><div class="bg-pink-600 text-white font-bold w-8 h-8 rounded-full flex items-center justify-center shrink-0">3</div><div><h4 class="text-white font-bold text-lg">AFP</h4><p class="text-sm">Si no hay plata en bancos, se activa el pago con fondos de pensi칩n (Excepcional).</p></div></div>
                        </div>
                    </section>
                    <section id="informales" class="scroll-mt-32">
                        <div class="legal-block">
                            <h3 class="text-xl font-bold text-white mb-3"><i class="fa-solid fa-mask text-slate-400 mr-2"></i> Trabajo Informal</h3>
                            <p class="text-slate-300">Si no tiene contrato, la ley presume que tiene ingresos para pagar al menos sobre el sueldo m칤nimo. Adem치s, si tiene auto o compra cosas caras con tarjeta, el SII lo informar치 al juez.</p>
                        </div>
                    </section>
                    <section id="miedos" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-8">Preguntas Frecuentes</h2>
                        <div class="space-y-4">
                            ${makeAccordion('m1', 'pink', 'Si demando, 쯠e quita al ni침o?', '<strong>Mito Urbano.</strong> Para quitarte el cuidado personal (tuici칩n) 칠l debe probar negligencia grave en un juicio largo y dif칤cil. Pedir alimentos es un derecho del ni침o, no una causal para perderlo.')}
                            ${makeAccordion('m2', 'pink', 'Me amenaza (Violencia)', 'Si hay amenazas por cobrar, esto pasa al 치mbito penal (VIF). Puedes pedir orden de alejamiento y prohibici칩n de acercamiento, y la pensi칩n se cobra igual.')}
                        </div>
                    </section>
                `
            },
            papa: {
                color: 'blue',
                icon: 'mars',
                title: 'Gu칤a para Padres',
                toc: [
                    {id:'realidad', t:'La Realidad Legal'},
                    {id:'deuda-explicada', t:'Entendiendo la Deuda'},
                    {id:'visitas', t:'Visitas vs. Plata'},
                    {id:'cesantia', t:'Estoy Cesante / Quebrado'},
                    {id:'gastos-madre', t:'쮼n qu칠 gasta la plata?'},
                    {id:'defensa', t:'C칩mo defenderse'},
                    {id:'diccionario', t:'Diccionario Simple'}
                ],
                html: `
                    <section id="realidad" class="scroll-mt-32 animate-fadeIn">
                        <div class="bg-blue-900/10 border-l-4 border-blue-500 p-6 md:p-8 rounded-r-xl">
                            <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">Evita problemas mayores.</h2>
                            <p class="text-slate-300 text-lg">La deuda de alimentos judicializada no prescribe f치cilmente y genera intereses. Entrar al Registro de Deudores bloquea tu vida financiera y documentos (licencia, pasaporte).</p>
                        </div>
                    </section>
                    <section id="deuda-explicada" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6">Error: "Pago cosas por fuera"</h2>
                        <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                            <p class="mb-4">Legalmente, la pensi칩n se paga <strong>depositando en la cuenta de ahorro</strong> que abri칩 el tribunal. Si pagas el furg칩n, el colegio o compras ropa directamente, eso se considera "regalo" y no descuenta deuda a menos que el juez lo haya autorizado.</p>
                        </div>
                    </section>
                    <section id="visitas" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-6">Visitas vs. Dinero</h2>
                        <p class="text-lg mb-4">Tener deuda NO te quita el derecho a ver a tu hijo (R칠gimen Comunicacional). Si la madre proh칤be las visitas por deuda, est치 vulnerando los derechos del ni침o y puedes demandar cumplimiento.</p>
                    </section>
                    <section id="cesantia" class="scroll-mt-32">
                        <div class="legal-block border-l-blue-400">
                            <h3 class="text-xl font-bold text-white mb-3">Estoy Cesante</h3>
                            <p class="text-slate-300">Si quedas sin trabajo, la pensi칩n <strong>sigue corriendo</strong> al mismo monto. Debes ir al tribunal inmediatamente y pedir una <strong>Rebaja de Alimentos</strong> o una suspensi칩n temporal. No esperes a tener deuda millonaria.</p>
                        </div>
                    </section>
                    <section id="gastos-madre" class="scroll-mt-32">
                        <h2 class="text-3xl font-black text-white mb-8">Preguntas Dif칤ciles</h2>
                        <div class="space-y-4">
                            ${makeAccordion('p1', 'blue', '쮼n qu칠 gasta la plata?', 'Quien tiene el cuidado personal administra la pensi칩n. El tribunal no fiscaliza gastos hormiga (comida, ropa) a menos que el ni침o est칠 en evidente estado de desnutrici칩n o abandono.')}
                            ${makeAccordion('p2', 'blue', 'Quiero la Tuici칩n', 'Debes probar en juicio que t칰 eres m치s id칩neo y que el ni침o estar치 mejor contigo. No basta con que ella "sea mala", debes probar tu capacidad de cuidado.')}
                        </div>
                    </section>
                `
            }
        };

        function makeAccordion(id, color, q, a) {
            const borderColor = color === 'pink' ? 'border-pink-500' : 'border-blue-500';
            const iconColor = color === 'pink' ? 'text-pink-400' : 'text-blue-400';
            return `
            <div class="faq-item">
                <button onclick="toggleAccordion('${id}')" class="faq-trigger group">
                    <span class="font-bold text-slate-200 group-hover:${iconColor} transition-colors text-base md:text-lg flex items-center gap-3"><i class="fa-regular fa-circle-question ${iconColor} opacity-50"></i> ${q}</span>
                    <i id="icon-${id}" class="fa-solid fa-chevron-down text-slate-500 transition-transform duration-300"></i>
                </button>
                <div id="${id}" class="faq-content ${borderColor}"><div class="text-reading text-slate-300 text-lg leading-relaxed">${a}</div></div>
            </div>`;
        }

        function toggleAccordion(id) {
            const el = document.getElementById(id);
            const icon = document.getElementById(`icon-${id}`);
            if (el.style.display === 'block') { el.style.display = 'none'; icon.style.transform = 'rotate(0deg)'; }
            else { el.style.display = 'block'; icon.style.transform = 'rotate(180deg)'; }
        }

        function enterSite(profile) {
            const data = contentData[profile];
            const badge = document.getElementById('profile-badge');
            const colorClass = profile === 'mama' ? 'text-pink-400 border-pink-500/50 bg-pink-900/20' : 'text-blue-400 border-blue-500/50 bg-blue-900/20';
            badge.innerHTML = `<span class="border ${colorClass} px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider flex items-center gap-2"><i class="fa-solid fa-${data.icon}"></i> Modo ${profile === 'mama' ? 'Madre' : 'Padre'}</span>`;
            
            const tocHTML = data.toc.map(i => `<a href="#${i.id}" onclick="closeMobileToc()" class="block py-2 px-3 text-sm text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-all border-l-2 border-transparent hover:border-${data.color}-500">${i.t}</a>`).join('');
            document.getElementById('toc-desktop').innerHTML = tocHTML;
            document.getElementById('toc-mobile').innerHTML = tocHTML;
            document.getElementById('main-content').innerHTML = data.html + renderDictionary(profile);
            
            document.getElementById('landing-section').classList.add('hidden');
            const guide = document.getElementById('guide-ui');
            guide.classList.remove('hidden');
            guide.classList.add('visible-section');
            window.scrollTo(0,0);
        }

        function renderDictionary(profile) {
            const color = profile === 'mama' ? 'pink' : 'blue';
            return `
            <section id="diccionario" class="scroll-mt-32 pt-12 border-t border-slate-800 mt-12">
                <h2 class="text-3xl font-black text-white mb-6">Diccionario Jur칤dico B치sico</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-800/40 p-4 rounded-lg"><strong class="text-${color}-400 block mb-1">UTM (Unidad Tributaria Mensual)</strong><span class="text-sm text-slate-400">Las pensiones se fijan en UTM para que suban solas con la inflaci칩n.</span></div>
                    <div class="bg-slate-800/40 p-4 rounded-lg"><strong class="text-${color}-400 block mb-1">Apremios</strong><span class="text-sm text-slate-400">Castigos legales: Arresto nocturno, arraigo nacional, suspensi칩n de licencia de conducir.</span></div>
                    <div class="bg-slate-800/40 p-4 rounded-lg"><strong class="text-${color}-400 block mb-1">Interconexi칩n</strong><span class="text-sm text-slate-400">Sistema que permite al juez ver cuentas bancarias y datos del SII autom치ticamente.</span></div>
                    <div class="bg-slate-800/40 p-4 rounded-lg"><strong class="text-${color}-400 block mb-1">Cuidado Personal</strong><span class="text-sm text-slate-400">Antes llamado "Tuici칩n". Es qui칠n vive con el ni침o y toma las decisiones diarias.</span></div>
                </div>
            </section>`;
        }

        function exitSite() {
            document.getElementById('guide-ui').classList.add('hidden');
            document.getElementById('guide-ui').classList.remove('visible-section');
            document.getElementById('landing-section').classList.remove('hidden');
        }

        function closeMobileToc() { document.getElementById('mobile-toc-modal').classList.add('hidden'); }
        function handleKeyPress(e) { if(e.key === 'Enter') performSearch(); }

        // --- L칍GICA DE B칔SQUEDA DE 3 NIVELES ---
        async function performSearch() {
            const query = document.getElementById('ai-search-input').value.toLowerCase().trim();
            const panel = document.getElementById('ai-results-panel');
            if(!query) return;

            // UI Loading
            panel.innerHTML = `<div class="ai-result-card text-center"><div class="flex flex-col items-center justify-center py-6"><div class="typing-indicator mb-4"><span></span><span></span><span></span></div><p class="text-sm font-bold text-slate-400 uppercase tracking-widest">Consultando BCN & Leyes...</p></div></div>`;
            panel.classList.remove('hidden');

            // NIVEL 1: B칰squeda Local (Exacta)
            const localMatch = localDB.find(item => item.keywords.some(k => query.includes(k)));

            if(localMatch) {
                setTimeout(() => renderResult(localMatch.title, localMatch.text, "Respuesta Inmediata (Base Local)", "bolt"), 600);
            } else {
                // NIVEL 2: Consulta a Gemini (Jurista)
                try {
                    const aiResponse = await fetchGeminiResponse(query);
                    renderResult("An치lisis Jur칤dico IA", aiResponse, "IA Experta (Gemini 2.5)", "robot");
                } catch (error) {
                    console.warn("Fallo Nivel 2 (API), activando Nivel 3 (Fallback L칩gico)");
                    // NIVEL 3: Fallback Algor칤tmico (Offline / Error)
                    const offlineResponse = getOfflineResponse(query);
                    renderResult("Orientaci칩n General de Respaldo", offlineResponse, "Sistema de Respaldo (Sin Conexi칩n)", "shield-halved");
                }
            }
        }

        // --- NIVEL 2: PROMPT ENGINEERING AVANZADO ---
        async function fetchGeminiResponse(userQuery) {
            const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            // EL CEREBRO DE LA IA: Experta en BCN y leyes conectadas
            const systemPrompt = `
                Act칰a como una Abogada Jurista Experta en Legislaci칩n Chilena, con acceso simulado a toda la Biblioteca del Congreso Nacional (BCN).
                Tu especialidad principal es la Ley 21.484 (Responsabilidad Parental), pero debes analizar cada caso de forma sist칠mica, conectando con:
                1. C칩digo Civil (Familia, Bienes).
                2. C칩digo Penal (Si hay amenazas, golpes, VIF, injurias).
                3. C칩digo del Trabajo (Si mencionan despido, finiquito, sueldo).
                4. Ley de Tribunales de Familia.

                Instrucciones:
                - Responde con autoridad t칠cnica pero empat칤a humana.
                - Cita la ley o el c칩digo si es pertinente (ej: "Seg칰n el C칩digo Penal...").
                - Si te preguntan algo fuera de familia, responde igual usando la ley chilena general.
                - S칠 concisa (m치ximo 120 palabras).
                - Estructura con negritas (<b></b>).
            `;
            
            const payload = { contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
            
            const response = await fetch(endpoint, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
            if(!response.ok) throw new Error("API Error");
            const data = await response.json();
            const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
            if(!text) throw new Error("No candidate");
            return text;
        }

        // --- NIVEL 3: CEREBRO DE RESPALDO (Algoritmo Offline) ---
        function getOfflineResponse(query) {
            // Diccionario de conceptos legales para reconstruir respuesta
            let response = "";
            
            // Detectar 치rea del derecho
            if (query.includes("pega") || query.includes("golpe") || query.includes("amenaza") || query.includes("miedo")) {
                response = "Detecto una situaci칩n de riesgo. En Chile, esto se rige por la <strong>Ley de Violencia Intrafamiliar (VIF)</strong> y el C칩digo Penal. Independiente de la pensi칩n de alimentos, puedes solicitar medidas cautelares inmediatas (orden de alejamiento) en Carabineros o Fiscal칤a. La deuda de alimentos se cobra en paralelo en el Tribunal de Familia.";
            } else if (query.includes("despido") || query.includes("trabajo") || query.includes("finiquito") || query.includes("cesante")) {
                response = "Este tema conecta Derecho de Familia con <strong>Derecho Laboral</strong>. Si hay despido, el empleador debe retener parte del finiquito para pagar deudas de alimentos si existe orden judicial. Si est치s cesante, debes acudir al Tribunal de Familia inmediatamente para pedir una rebaja, de lo contrario la deuda seguir치 acumul치ndose.";
            } else if (query.includes("casa") || query.includes("herencia") || query.includes("auto")) {
                response = "Est치s consultando sobre temas patrimoniales (<strong>C칩digo Civil</strong>). Recuerda que la pensi칩n de alimentos puede cobrarse sobre el patrimonio del deudor (bienes, herencias), pero requiere un juicio ejecutivo. El tribunal puede embargar bienes para pagar la deuda.";
            } else {
                response = "Entiendo tu consulta sobre familia. Seg칰n la <strong>Ley 21.484</strong>, el principio rector es el Inter칠s Superior del Ni침o. Si es sobre cobros, recuerda que existe el mecanismo de retenci칩n autom치tica. Si es sobre visitas o cuidado personal, la ley exige pasar primero por un proceso de <strong>Mediaci칩n Familiar</strong> obligatoria antes de demandar.";
            }
            return response;
        }

        function renderResult(title, text, source, icon) {
            const panel = document.getElementById('ai-results-panel');
            let formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
            
            // Color coding source
            let badgeClass = "bg-brand-purple";
            if(source.includes("Respaldo")) badgeClass = "bg-gray-600";
            if(source.includes("Local")) badgeClass = "bg-blue-600";

            panel.innerHTML = `
                <div class="ai-result-card relative border-l-4 border-brand-purple">
                    <div class="absolute -top-3 left-4 ${badgeClass} px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider text-white shadow-md flex items-center gap-2">
                        <i class="fa-solid fa-${icon}"></i> ${source}
                    </div>
                    <button onclick="document.getElementById('ai-results-panel').classList.add('hidden')" class="absolute top-2 right-2 text-slate-400 hover:text-white p-2"><i class="fa-solid fa-xmark"></i></button>
                    
                    <h3 class="text-white font-bold text-lg mt-3 mb-2">${title}</h3>
                    <div class="ai-content text-slate-200 text-sm leading-relaxed">${formattedText}</div>
                    
                    <div class="mt-4 pt-2 border-t border-slate-700 text-[10px] text-slate-500 text-right">
                        Basado en legislaci칩n vigente (Chile)
                    </div>
                </div>`;
        }

        // --- THREE.JS ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({alpha:true, antialias:true});
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const particles = new THREE.Group();
        const geo = new THREE.SphereGeometry(0.05, 8, 8);
        const mat = new THREE.MeshBasicMaterial({color: 0x64748b});
        for(let i=0; i<300; i++) {
            const mesh = new THREE.Mesh(geo, mat);
            mesh.position.set((Math.random()-0.5)*30, (Math.random()-0.5)*30, (Math.random()-0.5)*30);
            particles.add(mesh);
        }
        scene.add(particles);
        camera.position.z = 15;
        function animate() { requestAnimationFrame(animate); particles.rotation.y += 0.0005; renderer.render(scene, camera); }
        animate();
        window.addEventListener('resize', ()=>{ camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); });
    </script>
</body>
</html>
